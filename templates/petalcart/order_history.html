{% extends 'main.html' %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cart.css' %}">
<style>
  .pagination {
    text-align: center;
    margin-top: 20px;
    padding: 20px 0;
  }
  .pagination a, .pagination span {
    padding: 8px 12px;
    margin: 0 5px;
    text-decoration: none;
    border: 1px solid #ddd;
    border-radius: 4px;
    background-color: #f9f9f9;
  }
  .pagination a:hover {
    background-color: #e8e8e8;
  }
  .pagination .active {
    background-color: #28a745;
    color: white;
    border-color: #28a745;
  }
</style>
{% endblock %}
{% block content %}

<div class="order-container">
  <h2>Your Order History</h2>
  {% if orders %}
    {% for order in orders %}
    <div class="order-card">
      <div class="order-header">
        <div>
          <strong>Order ID:</strong> #{{ order.order_id|stringformat:".8s" }}...<br>
          <small>Placed on: {{ order.created|date:"d M Y" }}</small>
        </div>
        <div class="text-right">
          <span class="status-badge status-{{ order.status|lower }}">{{ order.status }}</span><br>
          <strong style="font-size: 1.2rem;">Total: ₹{{ order.total }}</strong>
        </div>
      </div>

      <!-- Loop through items for THIS specific order -->
      {% for item in order.orderitem_set.all %}
      <div class="order-item">
        <div class="item-image">
          <img src="{{ item.flower.img.url }}" alt="{{ item.flower.flowername }}">
        </div>
        <div class="item-details">
          <h5>{{ item.flower.flowername }}</h5>
          <p>Qty: {{ item.quantity }} × ₹{{ item.price }}</p>
        </div>
        <div class="item-total">
          ₹{{ item.price }}
        </div>
      </div>
      {% endfor %}
    </div>
    {% endfor %}

    <!-- Pagination -->
    <div class="pagination">
      {% if has_prev %}
        <a href="?page=1">First</a>
        <a href="?page={{ page|add:'-1' }}">Previous</a>
      {% endif %}

      <span class="active">Page {{ page }} of {{ total_pages }}</span>

      {% if has_next %}
        <a href="?page={{ page|add:'1' }}">Next</a>
        <a href="?page={{ total_pages }}">Last</a>
      {% endif %}
    </div>
  {% else %}
    <p>You haven't placed any orders yet.</p>
  {% endif %}
</div>
{% endblock %}
