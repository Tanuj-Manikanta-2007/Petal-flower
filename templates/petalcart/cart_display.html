{% extends 'main.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/cart.css' %}">

<div class="cart-container">

  <!-- Left Column: Product List -->
  <div class="cart-card">
    <h3>Your Shopping Cart</h3>

    {% if items %}
      {% for item in items %}
      <div class="cart-item">

        <!-- Product Image -->
        <div class="item-image">
          <img src="{{ item.flower.img.url }}" alt="{{ item.flower.flowername }}">
        </div>

        <!-- Product Details -->
        <div class="item-details">
          <h4>{{ item.flower.flowername }}</h4>
          <p>Unit Price: â‚¹{{ item.flower.price }}</p>

          <!-- Quantity Update Form -->
          <form method="post" action="{% url 'update_cart' item.id %}">
            {% csrf_token %}
            <div class="quantity-controls">
              <button type="button" onclick="changeQuantity(-1, {{ item.id }})">-</button>

              <input type="number" 
                     name="quantity" 
                     value="{{ item.quantity }}" 
                     min="1" 
                     max="{{ item.flower.stock.quantity }}"
                     onchange="updateQuantity({{ item.id }}, this.value)">
              
              <button type="button" onclick="changeQuantity(1, {{ item.id }})">+</button>
            </div>

            <a href="{% url 'delete_cart' item.id %}" 
               style="color:#dc3545; text-decoration:none; margin-left:10px;">
               Remove
            </a>
          </form>
        </div>

        <!-- Item Total -->
        <div class="item-total">
          â‚¹{{ item.subtotal }}
        </div>

      </div>
      {% endfor %}

    {% else %}
      <div style="padding: 40px; text-align: center;">
        <h3>Your cart is empty ðŸŒ¸</h3>
        <a href="{% url 'home' %}" style="color: #007bff;">Continue Shopping</a>
      </div>
    {% endif %}
  </div>

  <!-- Right Column: Checkout Summary -->
  {% if items %}
  <div class="cart-card">
    <h3>Summary</h3>

    <div class="summary-row">
      <span>Subtotal</span>
      <span>â‚¹{{ total_price }}</span>
    </div>

    <div class="summary-row">
      <span>Shipping</span>
      <span style="color: #28a745;">FREE</span>
    </div>

    <div class="total-row">
      <span>Total</span>
      <span>â‚¹{{ total_price }}</span>
    </div>

    <form method="POST" action="{% url 'checkout_cart' %}">
        {% csrf_token %}
        <button type="submit" class="btn">Proceed to Checkout</button>
    </form>
  </div>
  {% endif %}

</div>

<!-- JS (Optional) -->
<script>
function changeQuantity(amount, id) {
    let input = document.querySelector(`input[name="quantity"]`);
    let newVal = parseInt(input.value) + amount;
    if (newVal >= 1) {
        input.value = newVal;
        input.form.submit();
    }
}

function updateQuantity(id, val) {
    document.querySelector(`input[name="quantity"]`).form.submit();
}
</script>

{% endblock %}
